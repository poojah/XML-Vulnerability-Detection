<?php
session_start();

function extractText($array){
	if(count($array) <= 1){
		//we only have one tag to process!
		for ($i = 0; $i<count($array); $i++){
			$node = $array->item($i);
			$value = $node->nodeValue;
		}
		return $value;
	} 
	
}	


//pull in the XML file
$file=$_GET['file'];

if ($file == ""){

	echo "<h2>You didn't choose a file to edit!</h2>";
	echo "<a href=\"index.php\">Go back to index and choose a file</a>";
	exit;
} else {
	$open = "./xml/" . $file;
	$xml = new DomDocument;
	@$xml ->load($open);
	$root = $xml->documentElement;
	
	$id = $root->getAttribute("id");

	$h_array = $root->getElementsByTagname("headline");
	$headline = extractText($h_array);

	//$stat_array = $root->getElementsByTagname("status");
	//$status = extractText($stat_array);

		
	$a_array = $root->getElementsByTagname("author");
	$author = extractText($a_array);
	
	$e_array = $root->getElementsByTagname("email");
	$email = extractText($e_array);
	
	$ab_array = $root->getElementsByTagname("abstract");
	$abstract = extractText($ab_array);

	$kl_array = $root->getElementsByTagname("keywords");
	$keywords = extractText($kl_array);
	
	$lead_array = $root->getElementsByTagname("para-intro");
	$para["intro"] = extractText($lead_array);

	$second_array = $root->getElementsByTagname("para-main");
	$para["main"] = extractText($second_array);

	$con_array = $root->getElementsByTagname("para-conclusion");
	$para["con"] = extractText($con_array);
	

?>
<html>
<head>
<title><?php echo $headline; ?></title>
<meta name="keywords" content="<?php echo $keywords; ?>">
<meta name="description" content="<?php echo $abstract; ?>">

</head>
<body>
<h1><?php echo $headline; ?></h1>
<a href="index.php">back to main</a>
<p>by <a href="mailto:<?php echo $email; ?>"><?php echo $author; ?></a></p>
<p><small><?php echo $abstract; ?></small></p>
<?php
foreach ($para as $k => $v){
	echo "<p>".$v."</p>\n";
}

?>
</body>
</html>

<?php
}
?>