<?php
session_start();



function extractText($array){
	if(count($array) <= 1){
		//we only have one tag to process!
		for ($i = 0; $i<count($array); $i++){
			$node = $array->item($i);
			$value='';
			//$value = $node->nodeValue;
			
		}
		return $value;
	} 
	
}
	

if ($_SESSION["login"] != "true"){
	header("Location:login.php");
	$_SESSION["error"] = "<font color=red>You don't have privileges to see the admin page.</font>";
	exit;
}
//pull in the XML file
$file = $_SESSION['file'];

if ($file == ""){

	echo "<h2>You didn't choose a file to edit!</h2>";
	echo "<a href=\"adminindex.php\">Go back to index and choose a file</a>";
	exit;
} else {
	$filename = "./xml/".$file;
	$xml=new DomDocument;
	$xml ->load($filename);
	$root=$xml->documentElement;
	
	$id = $root->getAttribute("id");

	$h_array = $root->getElementsByTagName("headline");
	$headline = extractText($h_array);

	$stat_array = $root->getElementsByTagName("status");
	$status = extractText($stat_array);

		
	$a_array = $root->getElementsByTagName("author");
	$author = extractText($a_array);
	
	$e_array = $root->getElementsByTagName("email");
	$email = extractText($e_array);
	
	$ab_array = $root->getElementsByTagName("abstract");
	$abstract = extractText($ab_array);

	$kl_array = $root->getElementsByTagName("keywords");
	$keywords = extractText($kl_array);
	
	$lead_array = $root->getElementsByTagName("para-intro");
	$plead = extractText($lead_array);

	$second_array = $root->getElementsByTagName("para-main");
	$pmain = extractText($second_array);

	$con_array = $root->getElementsByTagName("para-conclusion");
	$pcon = extractText($con_array);
	
	$statusList = array("live","in progress");
	
?>
<html>
<title>Edit an XML Article</title>
<body>
<h1>Edit an XML Article</h1>

<a href="adminindex.php">Cancel</a><br><br>
<form name="createArticle" action="updateArticle.php" method="post">
  <table border=1 cellspacing=0 cellpadding=3>
    <tr valign=top> 
      <td width="135">Article ID</td>
      <td width="634"> <?php echo htmlspecialchars($id); ?> <input type="hidden" name="id" value="<?php echo $id; ?>"> 
      </td>
    </tr>
    <tr valign=top>
      <td>Status</td>
      <td>
	  <select name="status">
	  <?php
	  	foreach ($statusList as $stat){
			if($stat == $status){
				echo "<option value=\"".$stat."\" selected>$stat";
			} else {
				echo "<option value=\"".$stat."\">$stat";

			}
		}
	  ?>
	  </select>
	  </td>
    </tr>
    <tr valign=top> 
      <td>Headline</td>
      <td> <input name="headline" type="text" id="headline" value="<?php echo htmlspecialchars($headline); ?>" size="60"></td>
    </tr>
    <tr valign=top> 
      <td>Author Name</td>
      <td> <input name="name" type="text" id="name" value="<?php echo htmlspecialchars($author); ?>"size="30"></td>
    </tr>
    <tr valign=top> 
      <td>Author Email</td>
      <td> <input name="email" type="text" id="email" value="<?php echo htmlspecialchars($email); ?>"size="30"></td>
    </tr>
    <tr valign=top> 
      <td>Keywords</td>
      <td> <input name="keywords" type="text" value="<?php echo htmlspecialchars($keywords); ?>"> 
        <br> <font size="-1">(separate keywords with commas)</font> </td>
    </tr>
    <tr valign=top> 
      <td>Abstract</td>
      <td><textarea name="abstract" cols="50" rows="5" id="abstract"><?php echo htmlspecialchars($abstract); ?></textarea></td>
    </tr>
    <tr valign=top> 
      <td> <p>Article Body<br>
        </p></td>
      <td> <p>Intro paragraph:</p>
        <p> 
          <textarea name="body[intro]" cols="70" rows="10" wrap="soft" id="body[intro]"><?php echo htmlspecialchars($plead); ?></textarea>
        </p>
        <p>Main paragraph:</p>
        <p> 
          <textarea name="body[main]" cols="70" rows="10" wrap="soft" id="body[main]" ><?php echo htmlspecialchars($pmain); ?></textarea>
        </p>
        <p>Conclusion paragraph:</p>
        <p> 
          <textarea name="body[conclusion]" cols="70" rows="10" wrap="soft"><?php echo htmlspecialchars($pcon); ?></textarea>
        </p></td>
    </tr>
    <tr valign=top> 
      <td colspan=2> <div align="center"> 
          <input type="submit" name="Add Article" value="Add Article">
          &nbsp; 
          <input name="reset" type="reset" id="reset" value="Reset">
        </div></td>
    </tr>
  </table>
</form>
</body>
</html>
<?php
}//end if-else
?>